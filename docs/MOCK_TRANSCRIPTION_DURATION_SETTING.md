# Настройка времени имитации транскрибации

## Дата: 6 декабря 2025

### Описание

Добавлена возможность настройки времени имитации процесса транскрибации для демонстрации на презентациях. Время можно настроить в интерфейсе настроек приложения.

## Функциональность

### Настройка времени

- **Расположение**: Настройки → Тестовые данные
- **Параметр**: Время имитации транскрибации (секунды)
- **Диапазон**: от 1 до 120 секунд
- **По умолчанию**: 5 секунд

### Использование

1. Откройте страницу **Настройки**
2. Перейдите в секцию **"Тестовые данные"**
3. В поле **"Время имитации транскрибации"** введите нужное значение (в секундах)
4. Нажмите кнопку **"Сохранить"**
5. При следующем запуске транскрибации анимация обработки займёт указанное время

## Технические детали

### Backend изменения

**Файл**: `app/main.py`

Добавлены два новых API эндпоинта:

- `GET /api/mock-settings` - получение текущего времени имитации
- `POST /api/mock-settings` - сохранение времени имитации

Настройки сохраняются в базе данных в таблице `test_data` с ключом `mock_transcription_duration`.

### Frontend изменения

**Файл**: `templates/settings.html`

- Добавлено поле ввода времени имитации
- Добавлена кнопка сохранения
- Добавлен JavaScript для загрузки и сохранения настроек

**Файл**: `static/js/audio-handler.js`

- Добавлена переменная `mockDuration` (по умолчанию 5 секунд)
- Добавлен метод `loadMockSettings()` для загрузки настроек с сервера
- Обновлена функция `showProcessingScreen()` для использования времени из настроек
- Время распределяется пропорционально между этапами обработки:
  - Загрузка аудио: 27% от общего времени
  - Извлечение речи: 40% от общего времени
  - Формирование стенограммы: 33% от общего времени

### Версионирование

- Версия приложения обновлена: `1.0.0` → `1.0.1`
- Это обеспечивает загрузку обновлённого JavaScript файла браузером

## Примеры использования

### Для быстрой демонстрации (3 секунды)

1. Установите время: **3 секунды**
2. Сохраните настройки
3. Запустите транскрибацию - процесс займёт 3 секунды

### Для подробной демонстрации (30 секунд)

1. Установите время: **30 секунд**
2. Сохраните настройки
3. Запустите транскрибацию - процесс займёт 30 секунд с детальными этапами

## Отладка

В консоли браузера (F12) доступны логи:

- `AudioHandler: настройки загружены, время имитации: X сек` - настройки успешно загружены
- `AudioHandler: запуск обработки, время имитации: X сек` - запуск обработки с указанным временем

## API

### Получить текущие настройки

```bash
curl https://elia.su/api/mock-settings
```

Ответ:
```json
{
  "duration": 5
}
```

### Сохранить настройки

```bash
curl -X POST https://elia.su/api/mock-settings \
  -H "Content-Type: application/json" \
  -d '{"duration": 10}'
```

Ответ:
```json
{
  "success": true,
  "message": "Настройки сохранены",
  "duration": 10
}
```

## Примечания

- После обновления приложения необходимо очистить кеш браузера (Ctrl+Shift+R или Cmd+Shift+R)
- Настройки сохраняются в базе данных и применяются ко всем последующим транскрибациям
- Если настройки не загружены, используется значение по умолчанию (5 секунд)

